# EMN-Exploit-study

For purely educational purposes, I've put together what I think was in the smart that drained $15M out of $EMN. The swap rates are a bit skewered on testnet but the flash loan sequence is the same.

[Great explanation of the $EMN exploit here](https://twitter.com/bkiepuszewski/status/1310901151311835136)

***Note***: All my stuff is unaudited. You should always assume there's malicious code in here until proven otherwise. Don't test this in prod.

### Environment setup
- Git clone this repo
- npm i --save @uniswap/v2-core
- npm i --save @uniswap/v2-periphery
- npm install dotenv
- npm install --save truffle-hdwallet-provider
- Setup your .env with your PKs and end points
- Setup your .gitignore to hide your .env
- Adjust truffle-config.js to point to your desired environment for deployment

### Contract setup
- Deploy /contracts/BondingCurve.sol separately
- Adjust the BondingCurve and IERC20 DAI addresses in /contracts/EminenceCurrencyEMN.sol
- Deploy /contracts/EminenceCurrencyEMN.sol separately
- Adjust the BondingCurve and EMN token addresses in /contracts/EminenceCurrencyEaave.sol
- Deploy /contracts/EminenceCurrencyEaave.sol separately

### Exploit setup
- Adjust the execute() function in /contracts/EmnExploitStudy.sol to reference the deployed EMN and eAAVE contract ABIs
- Compile and deploy /contracts/EmnExploitStudy.sol via this truffle project

### Execute exploit
- EmnExploitStudy.deployed().then(function(instance){return instance.flashSwap()});

### Rugpull
- EmnExploitStudy.deployed().then(function(instance){return instance.rugPull()});

Sample execution on Rinkeby testnet

